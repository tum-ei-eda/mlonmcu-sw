# IF(NOT ${TOOLCHAIN} STREQUAL "llvm")
#     MESSAGE(FATAL_ERROR "global_isel feature needs llvm toolchain")
# ENDIF()
# SET(GISEL_FLAGS)
# LIST(APPEND GISEL_FLAGS "-mllvm -global-isel=1")
# LIST(APPEND GISEL_FLAGS "-mllvm -global-isel-abort=2")
# SET(GISEL_TARGETS "all")
# MACRO(GLOBAL_ISEL_FEATURE_CALLBACK_STAGE_1)
#   MESSAGE(STATUS "GLOBAL_ISEL_FEATURE_CALLBACK_STAGE_1")
#   # IF()
#
#   LIST(APPEND FEATURE_EXTRA_C_FLAGS ${GISEL_FLAGS})
#   LIST(APPEND FEATURE_EXTRA_CXX_FLAGS ${GISEL_FLAGS})
#   FOREACH(X IN ITEMS ${GISEL_FLAGS})
#     MESSAGE(STATUS "X=${X}")
#     TARGET_COMPILE_OPTIONS(generic_mlonmcu PRIVATE "SHELL:$<$<COMPILE_LANGUAGE:C>:${X}>")
#     TARGET_COMPILE_OPTIONS(generic_mlonmcu PRIVATE "SHELL:$<$<COMPILE_LANGUAGE:CXX>:${X}>")
#   ENDFOREACH()
# ENDMACRO()
#
# REGISTER_FEATURE(GLOBAL_ISEL FEATURE_CALLBACK_DEFAULT GLOBAL_ISEL_FEATURE_CALLBACK_STAGE_1 FEATURE_CALLBACK_DEFAULT)
SET(GLOBAL_ISEL OFF CACHE BOOL "Enable LLVMs -global-isel=1")
SET(GLOBAL_ISEL_ABORT 2 CACHE STRING "Set LLVMs -global-isel-abort={0,1,2}")
IF(GLOBAL_ISEL)
    IF(NOT ${TOOLCHAIN} STREQUAL "llvm")
        MESSAGE(FATAL_ERROR "global_isel feature needs llvm toolchain")
    ENDIF()
    LIST(APPEND GISEL_FLAGS "-mllvm -global-isel=1")
    LIST(APPEND GISEL_FLAGS "-mllvm -global-isel-abort=${GLOBAL_ISEL_ABORT}")
    LIST(APPEND FEATURE_EXTRA_C_FLAGS ${GISEL_FLAGS})
    LIST(APPEND FEATURE_EXTRA_CXX_FLAGS ${GISEL_FLAGS})
ENDIF()
